<!DOCTYPE html>
<html lang="en">
<head>
  <title>Desafio</title>
  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/3d2765a2cd.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>	
</head>

<style>

body{
	background-color: #0e0e0e;
}



.inputName{
	margin-left: 12%;
    margin-bottom: 7%;
    width: 90px !important;
    height: 20px !important;
}


.avatar {
  vertical-align: middle;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  margin-left: 20px;
  margin-right: 20px;
}

.avat{
	cursor:pointer;
}

.selected {
  vertical-align: middle;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border-color: red;
  border-style: inset;
  margin-left: 20px;
  margin-right: 20px;
}

.winner {
  vertical-align: middle;
  width: 150px;
  height: 150px;
  border-radius: 50%;
  border-style: inset;
  margin-left: auto;
  margin-right: auto;
  display: block;

}


.result_yes {
    border-radius: 25px;
    background: #228B22;
    padding: 9px;
    width: 30%;
    text-align: center;
}

.result_no {
    border-radius: 25px;
    background: #B22222;
    padding: 9px;
    width: 42%;
    text-align: center;
}

.the_end {
    border-radius: 25px;
    background: #4a6da7;
    padding: 9px;
    width: 42%;
    text-align: center;
}


/* Style the video: 100% width and height to cover the entire window */
#bg_main {
  position: fixed;
  right: 0;
  bottom: 0;
  min-width: 100%;
  min-height: 100%;
}


/* Add some content at the bottom of the video/page */
.content {
  position: fixed;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  color: #f1f1f1;
  width: 100%;
  padding: 20px;
}


/* Letras da palavra*/
.char{
	width: 90px;
	height: 85px;
	margin-left: 5px;
	margin-right: 5px;
	text-align: center;
	padding: 0 0 0 0;
	font-size: 0.8em;
	
	
}

@keyframes animeChar {
  from {background-color: #a9ae3c;}
  to {background-color: #6c757d;}
}

.categ{
	color: #373433;
    font-weight: bold;
    background-color: cornsilk;
}

.unusedchar{
	font-size: 3rem;
	color: white;
}

.usedchar{
	font-size: 3rem;
	color: navy;
	pointer-events: none;
    cursor: default;
    text-decoration: none;
}

.notfoundChar{
}

.foudChar{
}


.headerSet{
     padding: 5px;
     font-size: 60px;
     border-width: 4px;
     border-color: #CCCCCC;
     background-color: #FFFFFF;
     color: #000000;
     border-style: double;
     border-radius: 20px;
     box-shadow: 0px 0px 5px rgba(66,66,66,.75);
     text-shadow: 0px 0px 5px rgba(66,66,66,.75);
}

.btn{
	background-color: #4a6da7!important; 
	border-color: #4a6da7!important;
}

.borderWord{
	border-color: azure;
    border-style: groove;
    width: max-content;
}
	
</style>


<body style="width: 99%;">
	<form id="myForm">
	
	<video autoplay muted loop id="bg_main">
		<source src="videos/bg_main.mp4" type="video/mp4">
	</video>
	
	
	
	<h1 style="padding-left: 10px;">Roda Roda Jw</h1>
	
	
	
	
	
	
		<!-- Upload do Xls com as perguntas e respostas -->
		<div class="modal fade" id="modal_step1" tabindex="-3" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" style="color: #4a6da7">Carregar as palavras</h3>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<h5>Faça o upload da planilha do Excel com as palavras. Cada palavra poderá ter até <b>10</b> caracteres. A planilha deverá ser como no exemplo abaixo:</h5>
						
						<img class="img-responsive" src="pictures/xls_words_example.JPG" width="100%"/> 
					
						<br></br>
						
						<div id="upload_xls" >
							
							<input type="file" id="fileUpload" onchange="step2();" style="width: auto!important; font-size: 10px!important"/>
							<input type="button" id="upload" value="Upload" onclick="Upload()" style="display: none"/>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" id="close_btn" class="btn btn-secondary" data-dismiss="modal" style="display: none">Close</button>
					</div>
				</div>
			</div>
		</div>
	
		<!-- Modal de Participantes -->
		<div class="modal fade" id="modal_step2" tabindex="-3" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" style="color: #4a6da7">Participantes</h3>
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<h5>Quantidade de participantes:</h5> 
						<div class="form-group">
						  <label for="qtd_players">Quantidade de participantes:</label>
						  <select class="form-control" id="qtd_players" onchange="changePlayersQtd();">
						    <option>1</option>
						    <option>2</option>
						    <option>3</option>
						    <option>4</option>
						    <option>5</option>
						    <option>6</option>
						    <option>7</option>
						    <option>8</option>
						    <option>9</option>
						    <option>10</option>
						  </select>
						</div>
						
						<br></br>
						
						<h5>Pronto! Você poderá personalizar o Nome e a Foto de cada jogador após fechar esta janela.</h5>
						<h6> - Clique em Nome e informe o nome do Participante</h6>
						<h6> - Clique no ícone de usuário para escolher uma foto</h6>
						
						<div class="row">
							<div class="col-4"></div>
								<div class="col-4">
									<img class="img-responsive" src="pictures/nomeFoto.JPG" width="100%"/>
								</div>
							<div class="col-4"></div>
						</div>
						
				</div>
					<div class="modal-footer">
						<button type="button" id="close_btn_participante" class="btn btn-secondary" data-dismiss="modal" style="display: none">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Upload do Xls com as perguntas e respostas -->
		
		
		
		
		
		
		
	
	<div id="painel">
		<div class="row">
			<div class="col-4">
			  	<canvas id="canvas" width="600" height="600"></canvas>
			</div>	 	
			
			
			
			<div class="col-8">
			
				<div id="set"></div>
				
				
				<div id="winner_div" style="display: none">
					<h2 align="center" style="color: white">
						<i class="fas fa-trophy" style="color: goldenrod;"></i>
						<output id="winner_name"></output>
						<i class="fas fa-trophy" style="color: goldenrod;"></i>
					</h2>
					<img id="winner_img" src="" alt="Avatar" class="winner" style="align-items: center">
					<h1 align="center" style="color: white">
						<output id="winner_tt" >0</output>
					</h1>
				</div>	
				
				<div class="row" id="result" style="margin-bottom: -10%;">
					<h2 id="result" style="display: none"></h2>
				</div>
			</div>
			
			
			
			
				
				
				
			

	  	</div>
	</div>


		</br></br>	
		<div class="d-flex justify-content-center" id="charBar" style="display: none!important; padding-top: 15px;">
			<div class="btn-toolbar mx-auto" role="toolbar">
				<div class="btn-group mr-2" role="group">
					<button type="button" class="btn btn-primary unusedchar" id="A" value="A" onclick="selectChar(this.value);">A</button>
					<button type="button" class="btn btn-primary unusedchar" id="B" value="B" onclick="selectChar(this.value);">B</button>
					<button type="button" class="btn btn-primary unusedchar" id="C" value="C" onclick="selectChar(this.value);">C</button>
					<button type="button" class="btn btn-primary unusedchar" id="D" value="D" onclick="selectChar(this.value);">D</button>
					<button type="button" class="btn btn-primary unusedchar" id="E" value="E" onclick="selectChar(this.value);">E</button>
					<button type="button" class="btn btn-primary unusedchar" id="F" value="F" onclick="selectChar(this.value);">F</button>
					<button type="button" class="btn btn-primary unusedchar" id="G" value="G" onclick="selectChar(this.value);">G</button>
					<button type="button" class="btn btn-primary unusedchar" id="H" value="H" onclick="selectChar(this.value);">H</button>
					<button type="button" class="btn btn-primary unusedchar" id="I" value="I" onclick="selectChar(this.value);">I</button>
					<button type="button" class="btn btn-primary unusedchar" id="J" value="J" onclick="selectChar(this.value);">J</button>
					<button type="button" class="btn btn-primary unusedchar" id="K" value="K" onclick="selectChar(this.value);">K</button>
					<button type="button" class="btn btn-primary unusedchar" id="L" value="L" onclick="selectChar(this.value);">L</button>
					<button type="button" class="btn btn-primary unusedchar" id="M" value="M" onclick="selectChar(this.value);">M</button>
					<button type="button" class="btn btn-primary unusedchar" id="N" value="N" onclick="selectChar(this.value);">N</button>
					<button type="button" class="btn btn-primary unusedchar" id="O" value="O" onclick="selectChar(this.value);">O</button>
					<button type="button" class="btn btn-primary unusedchar" id="P" value="P" onclick="selectChar(this.value);">P</button>
					<button type="button" class="btn btn-primary unusedchar" id="Q" value="Q" onclick="selectChar(this.value);">Q</button>
					<button type="button" class="btn btn-primary unusedchar" id="R" value="R" onclick="selectChar(this.value);">R</button>
					<button type="button" class="btn btn-primary unusedchar" id="S" value="S" onclick="selectChar(this.value);">S</button>
					<button type="button" class="btn btn-primary unusedchar" id="T" value="T" onclick="selectChar(this.value);">T</button>
					<button type="button" class="btn btn-primary unusedchar" id="U" value="U" onclick="selectChar(this.value);">U</button>
					<button type="button" class="btn btn-primary unusedchar" id="V" value="V" onclick="selectChar(this.value);">V</button>
					<button type="button" class="btn btn-primary unusedchar" id="W" value="W" onclick="selectChar(this.value);">W</button>
					<button type="button" class="btn btn-primary unusedchar" id="X" value="X" onclick="selectChar(this.value);">X</button>
					<button type="button" class="btn btn-primary unusedchar" id="Y" value="Y" onclick="selectChar(this.value);">Y</button>
					<button type="button" class="btn btn-primary unusedchar" id="Z" value="Z" onclick="selectChar(this.value);">Z</button>
				</div>
			</div>
		</div>




		<nav class="navbar navbar-expand-bg bg-dark navbar-dark fixed-bottom" style="height: 150px;">
	  		<button type="button" class="btn btn-danger btn-lg" id='spin'>Girar</button>

	  		<div id="p1"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp1">Nome</span></h5>
		  		
       			<input value="" type="text" id="textp1" name="textp1" class="blur inputName" maxlength="10" style="display: none;"></input>
		  				
  				<img id="img1" src="pictures/avatar.JPG" alt="Avatar" class="selected avat">
		  		<input id="profile-image1-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt1" >0</output>
	  			</h3>
	  		</div>
	  			
	  		<div id="p2"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp2">Nome</span></h5>
        		<input value="" type="text" id="textp2" name="textp2" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img2" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image2-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt2" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p3"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp3">Nome</span></h5>
        		<input value="" type="text" id="textp3" name="textp3" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img3" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image3-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt3" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p4"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp4">Nome</span></h5>
        		<input value="" type="text" id="textp4" name="textp4" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img4" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image4-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt4" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p5"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp5">Nome</span></h5>
        		<input value="" type="text" id="textp5" name="textp5" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img5" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image5-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt5" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p6"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp6">Nome</span></h5>
        		<input value="" type="text" id="textp6" name="textp6" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img6" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image6-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt6" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p7"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp7">Nome</span></h5>
        		<input value="" type="text" id="textp7" name="textp7" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img7" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image7-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt7" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p8"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp8">Nome</span></h5>
        		<input value="" type="text" id="textp8" name="textp8" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img8" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image8-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt8" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p9"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp9">Nome</span></h5>
        		<input value="" type="text" id="textp9" name="textp9" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img9" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image9-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt9" >0</output>
	  			</h3>
	  		</div>
	  		
	  		<div id="p10"  style="display: none">
	  			<h5 align="center" style="color: white"><span class="label label-default clickMe" for="textp10">Nome</span></h5>
        		<input value="" type="text" id="textp10" name="textp10" class="blur inputName" maxlength="10" style="display: none"></input>
		  		<img id="img10" src="pictures/avatar.JPG" alt="Avatar" class="avatar avat">
		  		<input id="profile-image10-upload" class="hidden" type="file"  accept="image/*" style="display: none;">
	  			<h3 align="center" style="color: white">
			  		<output id="tt10" >0</output>
	  			</h3>
	  		</div>
	  		
	  		

  			<div id="app" class="float-right"></div>
	  		
	  		<input hidden="true" id="player" value=""/>
	  		<input hidden="true" id="question" value=""/>
	  		<input hidden="true" id="score" value=""/>
	  		<input hidden="true" id="a_locked" value=""/>
			
			<audio id="audio_correct" src="sound/foundit.mp3"></audio>
			<audio id="audio_wrong" src="sound/notfound.mp3"></audio>
			<audio id="audio_pass" src="sound/pass.mp3"></audio>
			<audio id="audio_loose" src="sound/loose.mp3"></audio>
		
		</nav>
	
	
	
	
	


	</form>
</body>

<script type="text/javascript">

//initializing
$("#modal_step1").modal();


document.getElementById("player").value = 1;




var qtdPlayers = 1; 	
for(i = 1; i <= qtdPlayers; i++){
	document.getElementById("p" + i).style.display = "";
}

/*
document.getElementById("name1").value = "Douglas";
document.getElementById("name2").value = "Priscila";
document.getElementById("name3").value = "Joaquim";
document.getElementById("name4").value = "Jéssica";
document.getElementById("name5").value = "Guilherme";
//document.getElementById("name6").value = "";
//document.getElementById("name7").value = "";
//document.getElementById("name8").value = "";
//document.getElementById("name9").value = "";
//document.getElementById("name10").value = "";

*/



//questions
var sets = new Array();
var usedSets = new Array();
var setsPerGameSession = 8;//rodadas de conjunto de palavras por jogo.




function showBackGround(name){
	document.getElementById("bg_main").style.transition = "all 2s";
	
	if(name == 'main'){
		document.getElementById("bg_main").src = "videos/bg_main.mp4";
		document.getElementById("bg_main").style.display = "";
	}else if(name == 'correct'){
	
	}else{
	
	}
	

	
	document.getElementById("bg_main").style.display = "none";
	document.getElementById("bg_main").src = "videos/bg_correct.mp4";
	document.getElementById("bg_main").style.display = "";
}


function onClickToSpin(){
	document.getElementById("bg_main").src = "videos/bg_main.mp4";
	lockGirar();//bloqueia o botão Girar
	lockCharBar();

}

function afterSpinner(value){
	
	if(value == "Passa" || value == "Perdeu"){
		lockCharBar();
		updateScore();
		nextTurn();
	}else{
		unlockCharBar();
	}
}


function nextQuestion(){
	//obtém um número aleatório entre 0 e o último index da lista de perguntas 
	var indexOfRandomQuestion = parseInt(Math.floor(Math.random() * (questions.length)));

	if (!usedQuestions.includes(indexOfRandomQuestion)) {
		//se a questão aleatória não foi usada ela é selecionada
		usedQuestions.push(indexOfRandomQuestion);
		
		//define o index da pergunta que será exibida
		document.getElementById("question").value = indexOfRandomQuestion;
	}else{
		//se o número aleatório já tiver sido usado, então busca outro
		nextQuestion();
	}
	 
}
	
function updateScore(){
	var newScore = document.getElementById("score").value;
	if(newScore != "Passa" && newScore != "Perdeu"){
		var oldScore = document.getElementById("tt" + document.getElementById("player").value ).value;
		var newScore = parseInt(oldScore) + parseInt(newScore);
		document.getElementById("tt" + document.getElementById("player").value ).value = newScore;
	}else if(newScore == "Perdeu"){
		document.getElementById("audio_loose").play();
		document.getElementById("tt" + document.getElementById("player").value ).value = 0;
	}else if(newScore == "Passa"	){
		document.getElementById("audio_pass").play();
	}
}

function nextTurn(){
	nextPlayer();
	unlockGirar();
}

function nextPlayer(){
	document.getElementById("img" + document.getElementById("player").value).className = "avatar";
	
	if( parseInt(document.getElementById("player").value) == qtdPlayers){
		document.getElementById("player").value = 1;
	}else{
		document.getElementById("player").value = parseInt(document.getElementById("player").value) + 1;
	}
	document.getElementById("img" + document.getElementById("player").value).className = "selected";
}

function lockGirar(){
	document.getElementById("spin").disabled = 'disabled';
}
function unlockGirar(){
	document.getElementById("spin").disabled = '';
}

function lockCharBar(){
	document.getElementById("charBar").style.pointerEvents = "none";
}

function unlockCharBar(){
	document.getElementById("charBar").style.pointerEvents = "";
}


function showRanking(){
	var ranking = new Array();
	document.getElementById("set").style.display = "none";
	
	//obtém e organiza todos os pontos
	for(i = 1; i <= qtdPlayers; i++){
		ranking.push(document.getElementById("tt" + i).value);
	}
	ranking.sort(function(a, b){return b - a});
	
	//obtém o player com a maior pontuação e exibe
	for(i = 1; i <= qtdPlayers; i++){
		if(document.getElementById("tt" + i).value == ranking[0]){
			document.getElementById("winner_name").value = document.getElementById("textp" + i).value;
			document.getElementById("winner_img").src = document.getElementById("img" + i).src;
			document.getElementById("winner_tt").value = document.getElementById("tt" + i).value;
			document.getElementById("winner_div").style.display = "";
			document.getElementById("card").style.backgroundColor = "transparent";
			document.getElementById("card").style.borderColor = "transparent";
		}
	}
	
	
}
				













var options = ["10", "35", "25", "40", "Passa", "30", "5", "60", "80", "45", "100", "Perdeu", "200"];

var startAngle = 0;
var arc = Math.PI / (options.length / 2);
var spinTimeout = null;

var spinArcStart = 10;
var spinTime = 0;
var spinTimeTotal = 0;

var ctx;

document.getElementById("spin").addEventListener("click", spin);

function byte2Hex(n) {
  var nybHexString = "0123456789ABCDEF";
  return String(nybHexString.substr((n >> 4) & 0x0F,1)) + nybHexString.substr(n & 0x0F,1);
}

function RGB2Color(r,g,b) {
	return '#' + byte2Hex(r) + byte2Hex(g) + byte2Hex(b);
}

function getColor(item, maxitem) {
  var phase = 0;
  var center = 128;
  var width = 127;
  var frequency = Math.PI*2/maxitem;
  
  red   = Math.sin(frequency*item+2+phase) * width + center;
  green = Math.sin(frequency*item+0+phase) * width + center;
  blue  = Math.sin(frequency*item+4+phase) * width + center;
  
  return RGB2Color(red,green,blue);
}

function drawRouletteWheel() {
  var canvas = document.getElementById("canvas");
  if (canvas.getContext) {
    var outsideRadius = 200;
    var textRadius = 160;
    var insideRadius = 125;

    ctx = canvas.getContext("2d");
    ctx.clearRect(0,0,700,700);

    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;

    ctx.font = 'bold 20px Helvetica, Arial';

    for(var i = 0; i < options.length; i++) {
      var angle = startAngle + i * arc;
      //ctx.fillStyle = colors[i];
      ctx.fillStyle = getColor(i, options.length);

      ctx.beginPath();
      ctx.arc(350, 350, outsideRadius, angle, angle + arc, false);
      ctx.arc(350, 350, insideRadius, angle + arc, angle, true);
      ctx.stroke();
      ctx.fill();

      ctx.save();
      ctx.shadowOffsetX = -1;
      ctx.shadowOffsetY = -1;
      ctx.shadowBlur    = 0;
      ctx.shadowColor   = "rgb(220,220,220)";
      ctx.fillStyle = "black";
      ctx.translate(350 + Math.cos(angle + arc / 2) * textRadius, 
                    350 + Math.sin(angle + arc / 2) * textRadius);
      ctx.rotate(angle + arc / 2 + Math.PI / 2);
      var text = options[i];
      ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      ctx.restore();
    } 

    //Arrow
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.moveTo(350 - 4, 350 - (outsideRadius + 5));
    ctx.lineTo(350 + 4, 350 - (outsideRadius + 5));
    ctx.lineTo(350 + 4, 350 - (outsideRadius - 5));
    ctx.lineTo(350 + 9, 350 - (outsideRadius - 5));
    ctx.lineTo(350 + 0, 350 - (outsideRadius - 13));
    ctx.lineTo(350 - 9, 350 - (outsideRadius - 5));
    ctx.lineTo(350 - 4, 350 - (outsideRadius - 5));
    ctx.lineTo(350 - 4, 350 - (outsideRadius + 5));
    ctx.fill();
  }
}

function spin() {
	onClickToSpin();
	
	spinAngleStart = Math.random() * 10 + 10;
	spinTime = 0;
	spinTimeTotal = Math.random() * 3 + 4 * 1000;
	rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if(spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI / 180);
  drawRouletteWheel();
  spinTimeout = setTimeout('rotateWheel()', 30);
 }

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  var degrees = startAngle * 180 / Math.PI + 90;
  var arcd = arc * 180 / Math.PI;
  var index = Math.floor((360 - degrees % 360) / arcd);
  ctx.save();
  ctx.font = 'bold 50px Helvetica, Arial';
  var text = options[index];
  document.getElementById("score").value = text;
  ctx.fillText(text, 350 - ctx.measureText(text).width / 2, 350 + 10);
  ctx.restore();
  afterSpinner(text);
}

function easeOut(t, b, c, d) {
  var ts = (t/=d)*t;
  var tc = ts*t;
  return b+c*(tc + -3*ts + 3*t);
}

drawRouletteWheel();





//Upload do xls com as perguntas e respostas
function Upload() {
    //Reference the FileUpload element.
    var fileUpload = document.getElementById("fileUpload");

    //Validate whether File is valid Excel file.
    var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
    if (regex.test(fileUpload.value.toLowerCase())) {
        if (typeof (FileReader) != "undefined") {
            var reader = new FileReader();

            //For Browsers other than IE.
            if (reader.readAsBinaryString) {
                reader.onload = function (e) {
                    ProcessExcel(e.target.result);
                };
                reader.readAsBinaryString(fileUpload.files[0]);
            } else {
                //For IE Browser.
                reader.onload = function (e) {
                    var data = "";
                    var bytes = new Uint8Array(e.target.result);
                    for (var i = 0; i < bytes.byteLength; i++) {
                        data += String.fromCharCode(bytes[i]);
                    }
                    ProcessExcel(data);
                };
                reader.readAsArrayBuffer(fileUpload.files[0]);
            }
        } else {
            alert("Seu navegador não suporta HTML5.");
        }
    } else {
        alert("Apenas arquivos do Excel são permitidos.");
    }
    
    //oculta o componente após o upload
    document.getElementById("upload_xls").style.display = "none";
};

function ProcessExcel(data) {
    //Read the Excel File data.
    var workbook = XLSX.read(data, {
        type: 'binary'
    });

    //Fetch the name of First Sheet.
    var firstSheet = workbook.SheetNames[0];

    //Read all rows from First Sheet into an JSON array.
    var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);

    for (var i = 0; i < excelRows.length; i++) {
    	var category = excelRows[i].Category;
    	
    	var w1 = excelRows[i].W1;	
    	var w2 = excelRows[i].W2;	
    	var w3 = excelRows[i].W3;	
    	var w4 = excelRows[i].W4;
    	
    	var words = new Array();
    	words.push(w1, w2, w3, w4);
    	words.sort((a,b) => a.length - b.length);
    	
    	
    	//header
    	var gameSet = '<div style="font-size: 20px; margin-top: 5px;">';
    	gameSet = gameSet.concat('<div class="card text-white" style="width: 95%; padding-left: 5%; padding-right: 2%; height: 95%; background-color: #4a6da7" id="card">');
    	gameSet = gameSet.concat('<div class="card-body" >');
		gameSet = gameSet.concat('<div class="text-center display-1 headerSet categ rounded-pill" id="categoria">');
		gameSet = gameSet.concat('<output id="category">'+ category +'</output>');
		gameSet = gameSet.concat('</div>');
		gameSet = gameSet.concat('<br/><br/>');
						
    	//chars
    	for (var w = 0; w < words.length; w++) {
   			gameSet = gameSet.concat('<div class="row display-2">');
	    	for (var c = 0; c < words[w].length; c++) {
   				gameSet = gameSet.concat( '<div class="badge badge-secondary char">' );
   				gameSet = gameSet.concat( '<output class="notfoundChar" id="' + 'w' + (w + 1) +'_c' + (c+ 1) + '" style="display: none;">');
				gameSet = gameSet.concat( retira_acentos(words[w].charAt(c)).toUpperCase() );
   				gameSet = gameSet.concat( '</output>' );
    			gameSet = gameSet.concat( '</div>' );
	    	}
    		gameSet = gameSet.concat( '</div></br>' );
    		
   		}
					
    	gameSet = gameSet.concat('</div>');
    	gameSet = gameSet.concat('</div>');
    	gameSet = gameSet.concat('</div> </br>');
    	
    	
		
    	sets.push(gameSet);

    }	
    
    
    
    //carrega o set para a primeira rodada
    loadSet();
    document.getElementById("charBar").style.display = "";
    lockCharBar();
};



function loadSet(){
	var index = getRandomIndex();
	while(usedSets.includes(index)){
		index = getRandomIndex();
	}
	$('#set').append(sets[index]);
	usedSets.push(index);
}

function getRandomIndex(){
	return ramdomIndex = parseInt(Math.floor(Math.random() * (sets.length)));
}



//-------------------------------

function step2(){
	upload.click();
	close_btn.click();
	$("#modal_step2").modal();
}

function changePlayersQtd(){
	qtdPlayers = document.getElementById("qtd_players").value;
	
	//oculta todos na navbar
	for (var i = 1; i <= 10; i++) {
		document.getElementById("p" + i).style.display = "none";
	}
	
	//exibe de acordo com a qtd selecionada
	for (var i = 1; i <= qtdPlayers; i++) {
		document.getElementById("p" + i).style.display = "";
	}
	
}



$('.clickMe').click(function () {
    "use strict";
    $(this).hide();
    $('#' + $(this).attr('for'))
                    .val($(this).text())
                    .toggleClass("form-control")
                    .show()
                    .focus();
});

$('.blur').blur(function () {
    "use strict";
    $(this)
        .hide()
        .toggleClass("form-control");
    var myid = (this).id;
    $('span[for=' + myid + ']')
        .text($(this).val())
        .show();
});



	
	
	
$(document).ready(function() {

	    
    var readURL = function(input, id) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $(id).attr('src', e.target.result);
            }
    
            reader.readAsDataURL(input.files[0]);
        }
    }
    

    
    
    
    $("#profile-image1-upload").on('change', function(){
        readURL(this, "#img1");
    });
    
    $("#img1").on('click', function() {
       $("#profile-image1-upload").click();
    });
    
    $("#profile-image2-upload").on('change', function(){
        readURL(this, "#img2");
    });
    
    $("#img2").on('click', function() {
       $("#profile-image2-upload").click();
    });
    
    $("#profile-image3-upload").on('change', function(){
        readURL(this, "#img3");
    });
    
    $("#img3").on('click', function() {
       $("#profile-image3-upload").click();
    });
    
    $("#profile-image4-upload").on('change', function(){
        readURL(this, "#img4");
    });
    
    $("#img4").on('click', function() {
       $("#profile-image4-upload").click();
    });
    
    $("#profile-image5-upload").on('change', function(){
        readURL(this, "#img5");
    });
    
    $("#img5").on('click', function() {
       $("#profile-image5-upload").click();
    });

    $("#profile-image6-upload").on('change', function(){
        readURL(this, "#img6");
    });
    
    $("#img6").on('click', function() {
       $("#profile-image6-upload").click();
    });
    
    $("#profile-image7-upload").on('change', function(){
        readURL(this, "#img7");
    });
    
    $("#img7").on('click', function() {
       $("#profile-image7-upload").click();
    });
    
    $("#profile-image8-upload").on('change', function(){
        readURL(this, "#img8");
    });
    
    $("#img8").on('click', function() {
       $("#profile-image8-upload").click();
    });
    
    $("#profile-image9-upload").on('change', function(){
        readURL(this, "#img9");
    });
    
    $("#img9").on('click', function() {
       $("#profile-image9-upload").click();
    });
    
    $("#profile-image10-upload").on('change', function(){
        readURL(this, "#img10");
    });
    
    $("#img10").on('click', function() {
       $("#profile-image10-upload").click();
    });
    
});
	
	
function retira_acentos(str) {

    com_acento = "ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝŔÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþÿŕ";
	sem_acento = "AAAAAAACEEEEIIIIDNOOOOOOUUUUYRsBaaaaaaaceeeeiiiionoooooouuuuybyr";
    novastr="";
    for(i=0; i<str.length; i++) {
        troca=false;
        for (a=0; a<com_acento.length; a++) {
            if (str.substr(i,1)==com_acento.substr(a,1)) {
                novastr+=sem_acento.substr(a,1);
                troca=true;
                break;
            }
        }
        if (troca==false) {
            novastr+=str.substr(i,1);
        }
    }
    return novastr;
}	

function selectChar(selectedChar){
	lockCharBar();
	document.getElementById(selectedChar).className = "btn btn-primary usedchar";
	
	var wait = parseInt(Math.floor(Math.random() * 5) + 2) * 1300;
	
	setTimeout(function(){ checkChar(selectedChar) }, wait);
}	
	
function checkChar(selectedChar){
	
	var chars = document.getElementsByClassName("notfoundChar");
	var foundCharsInAllWords = new Array();
	var i;
	var notFound = 'true';
	
	for (i = 0; i < chars.length; i++) {
		if(chars[i].value == selectedChar){
			notFound = 'false';
			foundCharsInAllWords.push(chars[i].id);
					
		}
	}


	var i = 0;
	var refreshIntervalId = setInterval(function() { 	
				length = foundCharsInAllWords.length
				if (i < (foundCharsInAllWords.length )) {
					update(foundCharsInAllWords[i]);
					isEnd();
				} else {
					clearInterval(refreshIntervalId)
				}
				i++
				
	}, 2400)

	if(notFound== 'true'){
		document.getElementById("audio_wrong").play();
		nextTurn();
	}

	
	
}

function isEnd(){
console.log('entrou');
	if(isEndOfSet() == 'false'){
console.log('false');
		unlockGirar();
		playAgain();
	}else{
console.log('else');	
		if(isEndOfSet() == 'true' && isEndOfGame() == 'false'){
console.log('if');
			animateWords();
			setTimeout(function(){ nextSet() }, 15000);
			
		}else if(isEndOfSet() == 'true' && isEndOfGame() == 'true'){
console.log('else if');
			
			setTimeout(function(){ showRanking() }, 5000);
		}
		
	}
}

function animateWords(){
	var words = document.getElementsByClassName("row display-2");
	for (var i = 0; i < words.length; i++) {
		words[i].className = "row display-2 borderWord";
	}
}

function nextSet(){
	var index = getRandomIndex();
	while(usedSets.includes(index)){
		index = getRandomIndex();
	}
	document.getElementById("set").innerHTML = "";
	$('#set').append(sets[index]);
	usedSets.push(index);
	unlockGirar();
	resetCharBar();
}

function resetCharBar(){
	var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
	alphabet.forEach(function(letter) {
		document.getElementById(letter).className = "btn btn-primary unusedchar";
	});
}


function isEndOfSet(){
	var notfoundChars = document.getElementsByClassName("notfoundChar");
	if(typeof notfoundChars !== 'undefined' && notfoundChars.length > 0){
		return 'false';
	}
	return 'true';
}

function isEndOfGame(){
	if(usedSets.length == setsPerGameSession){
		return 'true';
	}
	return 'false';
}



function update(i) {
	document.getElementById("audio_correct").play();
	document.getElementById(i).parentElement.style.animation= "animeChar 2s";
	document.getElementById(i).style.display = "";
	document.getElementById(i).className = "foundChar";
	
	updateScore();
}
	
function playAgain(){
	
}

	      
</script>


</html>